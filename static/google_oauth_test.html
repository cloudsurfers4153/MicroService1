<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Google OAuth Full Test</title>
</head>
<body>
  <h2>Google OAuth Full Test Page</h2>
  <button id="btn-login">Login with Google</button>
  <h3>Callback Response</h3>
  <pre id="result" style="background:#eee;padding:12px;"></pre>

  <script>
    const apiBase = "";

    document.getElementById("btn-login").onclick = async () => {
      try {
        const r = await fetch("/auth/google/url");
        if (!r.ok) throw new Error("Failed " + r.status);
        const j = await r.json();
        window.location.href = j.auth_url;
      } catch (err) {
        document.getElementById("result").textContent = "Error: " + err;
      }
    };

    async function tryFetchCallbackResponse() {
      const params = new URLSearchParams(window.location.search);
      if (!params.has("code") || !params.has("state")) return;
      try {
        const resp = await fetch(window.location.href);
        const text = await resp.text();
        try {
          const obj = JSON.parse(text);
          document.getElementById("result").textContent = JSON.stringify(obj, null, 2);
        } catch {
          document.getElementById("result").textContent = text;
        }
      } catch (err) {
        document.getElementById("result").textContent = "Error fetch: " + err;
      }
    }

    tryFetchCallbackResponse();
  </script>
</body>
</html>
